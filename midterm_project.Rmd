---
title: "Midterm Election Predictions"
author: "Mitch Borgert"
output: html_document
---

```{r,echo = FALSE, message=FALSE,warning=FALSE,error=FALSE}
library(dplyr)
library(lubridate)
library(ggplot2)
library(tree)
library(pander)
midterm_polls = read.csv("C:/Users/mitch/Documents/portfolio/data/mid_polls.csv")

approve_polls = read.csv("C:/Users/mitch/Documents/portfolio/data/approv_polls.csv")
```
##The data:
```{r,echo = FALSE, message=FALSE,warning=FALSE,error=FALSE}
approve_polls$enddate = mdy(approve_polls$enddate)
midterm_polls$enddate = mdy(midterm_polls$enddate)

approve_mean = approve_polls %>% group_by(enddate) %>% summarise(appr = mean(approve))

mid_appr = left_join(midterm_polls,approve_mean, by = "enddate")

mid_appr = mid_appr %>% mutate(demwin = as.numeric(dem - rep))


mod1 = lm(demwin ~ appr + samplesize + enddate,data = mid_appr)
dat = mid_appr %>% select(appr, samplesize, enddate, dem, rep, demwin)

x = ymd("2018-04-19")
enddate = rep(x,21)
appr = 30:50
samplesize = rep(1000,21)

df = data.frame(appr,samplesize,enddate)

pander(head(dat))


predictions = data.frame(predict(mod1,df))
predictions = predictions %>% mutate(probs = predict.mod1..df./100, seats = 435*probs) %>% mutate(super = as.numeric((seats > 70)), regmaj = as.numeric((seats > 0)) )
```

###This data created from two datasets from 538. Appr is the presidents approval rating, samplesize is the sample size of each poll, enddate is when the poll was finished, and dem and rep are what percent of people want to vote for each party. I created the demwin variable since I was prediction the chance the democrats would have a majority. This variable was just dem - rep to see the difference in support.

##Predictions using a linear model:

```{r, message=FALSE,warning=FALSE,error=FALSE}
ggplot(predictions, aes(x = seats)) + geom_histogram(bins = 10)
mean(predictions$super)
mean(predictions$regmaj)
```

### First I created a linear model which used appr, samplesize, and enddate as predictors for demwin. I then created a dataframe with approval from 30% to 50% since thats close to the range of his approval, sample size constant at 1000, and the end date constant at the last data a poll was recorded. I used this dataframe to create a distribution of predictions for democratic support over republicans based on Trump's approval rating. I then used the predictions to find how many more seats in the house one party would win over the other. One party must have 70 more seats than the other to have a super majority and 1 more seat to have a regular majority. The probability for a super majority is 1 and the probability for a regular majority is 0. 

##Predictions using a cross validated tree:
```{r,message=FALSE,warning=FALSE,error=FALSE}
dat = mid_appr %>% select(demwin,appr,samplesize,enddate)
set.seed(1)
mod2 <- tree(demwin ~ .-demwin, data = dat)

cv.dat <- cv.tree(mod2)
plot(cv.dat)

mod2prune <- prune.tree(mod2, best = 8)
plot(mod2prune)
text(mod2prune, pretty = 0)
```

###First I made the tree and pruned it.

```{r}
predictions2 = data.frame(predict(mod2prune,df))
predictions2 = predictions2 %>% mutate(probs = predict.mod2prune..df./100, seats = 468*probs) %>% mutate(super = as.numeric((seats > 70)), regmaj = as.numeric((seats > 0)) )
ggplot(predictions2, aes(x = seats)) + geom_histogram()

mean(predictions2$super)
mean(predictions2$regmaj)


```

###I have the same variables as before but this time I made a tree. Democrats are 100% expected to have a majority, but they are not expected to have a super majority according to this tree. I feel that a tree would be much better with more related variables in the dataframe. 

